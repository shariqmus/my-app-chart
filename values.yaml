# -------------------------------------------------------------------
# 1. Application Identity (REQUIRED)
# -------------------------------------------------------------------
app:
  name: my-app
  environment: dev              # dev | uat | prod
  version: "1.0.0"              # logical app version (not image tag)
  owner: team-x

  labels:
    app.kubernetes.io/part-of: platform
    cost-center: cc-123

# -------------------------------------------------------------------
# 2. Image & Runtime
# -------------------------------------------------------------------
image:
  repository: nginx
  tag: alpine
  pullPolicy: IfNotPresent
  pullSecrets: []               # [{ name: regcred }]

# -------------------------------------------------------------------
# 3. Workload (Deployment)
# -------------------------------------------------------------------
workload:
  type: Deployment              # Deployment | StatefulSet (future)
  replicas: 1

  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 0
      maxSurge: 1

  revisionHistoryLimit: 5

  pod:
    annotations: {}
    labels: {}

    securityContext:
      runAsNonRoot: true
      fsGroup: 1000

    scheduling:
      nodeSelector: {}
      tolerations: []
      affinity: {}
      topologySpreadConstraints: []

# -------------------------------------------------------------------
# 4. Containers
# -------------------------------------------------------------------
containers:
  main:
    name: app
    port: 80

    env: []
    envFrom:
      configMaps: []
      secrets: []

    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "256Mi"

    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop: [ "ALL" ]

    probes:
      readiness: {}
      liveness: {}

    volumeMounts: []

  init: []          # list of initContainers
  sidecars: []      # list of additional containers

# -------------------------------------------------------------------
# 5. Volumes & Persistence
# -------------------------------------------------------------------
volumes: []

persistence:
  enabled: false
  mountPath: /data
  accessMode: ReadWriteOnce
  size: 8Gi
  storageClass: ""

# -------------------------------------------------------------------
# 6. Networking
# -------------------------------------------------------------------
service:
  enabled: true
  type: ClusterIP
  port: 80
  targetPort: 80
  annotations: {}

gateway:
  enabled: true

  mode: shared                    # shared | dedicated
  sharedGateway:
    name: shared-gateway
    namespace: gateway-system

  hostnames:
    - my-app.example.com

  routes:
    - path: /
      backendPort: 80
      weight: 1

ingress:
  enabled: false                  # legacy fallback only

# -------------------------------------------------------------------
# 7. Identity & Access
# -------------------------------------------------------------------
serviceAccount:
  enabled: true
  name: ""
  annotations: {}

rbac:
  enabled: false                  # roles defined externally

# -------------------------------------------------------------------
# 8. Secrets (Vault / External)
# -------------------------------------------------------------------
secrets:
  vault:
    enabled: false
    authRef: vault-auth
    mount: kv
    path: dev/apps/my-app
    destination:
      name: my-app-secret

# -------------------------------------------------------------------
# 9. Autoscaling & Resilience
# -------------------------------------------------------------------
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  metrics:
    cpu: 60
    memory: 60

podDisruptionBudget:
  enabled: false
  minAvailable: 1

# -------------------------------------------------------------------
# 10. Observability
# -------------------------------------------------------------------
observability:
  metrics:
    enabled: false
    path: /metrics
    interval: 15s

  logging:
    enabled: false

  tracing:
    enabled: false

# -------------------------------------------------------------------
# 11. Platform Policy Toggles (Enforced in Templates)
# -------------------------------------------------------------------
policies:
  production:
    enforceMinReplicas: 2
    forbidLatestTag: true
    requireResources: true
    requireProbes: true
    enforceSecurityContext: true
